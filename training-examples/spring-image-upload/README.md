* ### Referanslar
    Bu çalışmadaki örnekler **spring-image-upload** adlı projede kodlanmıştır.

* ### Upload pathlerinin tanımlanması(BE)
    ```
    file.upload.directory=/Users/leventyildiz/development/git/sbank-workshop/training-examples/spring-image-upload/target/media/
    ```

* ### endpointlerin oluşturulması(BE)
    Farklı host ve portlardan endpointlere erişimin açılması
    ```
    @CrossOrigin("*")
    ```
    
    MultipartFile ve ImageName'i parametre olarak alan bir POST endpointinin oluşturulması
    ```
    @PostMapping("/add")
    public String addFile(@RequestParam("file") MultipartFile file, @RequestParam String imageName){...}
    ```
    
* ### upload dizininin Java ile oluşturulması(BE)
    ```
    Files.createDirectories(Paths.get(uploadDir));
    ```

* ### Eklenen resmin isminin UUID ile belirlenip istenen lokasyona kopyalanması(BE)
    ```
    String filePath = generateFullFilePath(file);
    Path targetLocation = FileSystems.getDefault().getPath(filePath);
    Files.copy(file.getInputStream(), targetLocation, StandardCopyOption.REPLACE_EXISTING);
    ```

* ### Dosya içeriğinin byte array'e dönüştürülüp DB'ye kaydedilmesi(BE)
    ```
    byte[] bytes = file.getBytes();
    
    Media media = new Media();
    media.setFile_content(bytes);
    media.setName(imageName);
    
    repository.save(media);
    ```

* ### Entitynin oluşturulması (BE)
    - isim,id ve dosya içeriğini binary olarak tutacak bir entity oluşturulur.
    ```
    @Entity
    public class Media {
    
        @Id
        @GeneratedValue(strategy = GenerationType.IDENTITY)
        private Long id;
    
        private String name;
    
        @Column(length = 1000000)
        private byte[] file_content;
        
        ...
    }
    ```
    
    - SQL ile tablo oluşturma
    ```
    CREATE TABLE MEDIA (
        ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
        FILE_CONTENT BINARY(1000000),
        NAME VARCHAR(255),
        PRIMARY KEY (ID)
    )
    ```


* ### React ile Client Projenin oluşurulması (FE)

- create-react-app'in komut satırından kurulması
```
$ npm install -g create-react-app
```

- create-react-app ile react projesi oluşturma
```
$ create-react-app web
```

- oluşturulan react projesini ayağa kaldırma
```
$ cd web; npm start
```

* ### Image Upload işlemi (FE)
    FormData oluşturularak FETCH ile server'a POST etme
    ```
    const data = new FormData();
    data.append('file', selectedFile);
    data.append('imageName', selectedFile.name);
    
    fetch("http://localhost:8080/file/add", {
        method: 'POST',
        mode: 'no-cors',
        body: data
    }).then(response => response.text())
        .then(result => console.warn("result: ", result))
        .catch(error => console.warn('error', error));
    ```
    
    FETCH ile image listesinin alınması
    ```
    var requestOptions = {
        method: 'GET',
        redirect: 'follow'
    };
    fetch("http://localhost:8080/file/list", requestOptions)
        .then(response => response.text())
        .then(result => setImageList(JSON.parse(result)))
        .catch(error => console.log('error', error));
    ```

* ### Kaynaklar
    - https://www.w3adda.com/react-js-tutorial/reactjs-installation

[index için tıklayın](../README.md)
